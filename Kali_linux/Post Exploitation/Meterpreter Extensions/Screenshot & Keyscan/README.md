## ScreenShot 실습  

**sysinfo**  
현재 실행중인 시스템에 대한 정보를 얻기  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Meterpreter%20Extensions/Screenshot%20%26%20Keyscan/Source/%EC%8B%9C%EC%8A%A4%ED%85%9C%20%EC%A0%95%EB%B3%B4%20%EC%96%BB%EA%B8%B0.png)  

**idletime**  
현재 유휴시간 확인  
**screenshot**  
현재 실생중인 시스템의 현재 모습을 촬영  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Meterpreter%20Extensions/Screenshot%20%26%20Keyscan/Source/%EC%8B%9C%EC%8A%A4%ED%85%9C%20%EC%82%AC%EC%A7%84%EC%B0%8D%EA%B8%B0.png)  

#### 현재 Window Xp의 상태
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Meterpreter%20Extensions/Screenshot%20%26%20Keyscan/Source/%EC%8B%9C%EC%8A%A4%ED%85%9C%20%EC%82%AC%EC%A7%84%EC%B0%8D%EA%B8%B0(%EC%8B%A4%EC%A0%9C%20WindowXp).png)  

아까 Kali linux에서 ScreenShot을 찍었을 때 나왔던 위치에 사진이 위치해있다는 것을 확인하기 위해 아래의 명령어를 사용한다.  
이 명령어는 관리자 권한을 얻지 않은 일반 terminal에서 사용하는 방법이다.  
**sudo thunar**  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Meterpreter%20Extensions/Screenshot%20%26%20Keyscan/Source/%EC%8B%9C%EC%8A%A4%ED%85%9C%20%EC%82%AC%EC%A7%84%EC%B0%8D%EA%B8%B0(%EB%A3%A8%ED%8A%B8%20%ED%8F%B4%EB%8D%94%20%EC%97%B4%EA%B8%B0).png)  
이후 실제 파일을 Kali의 imag view에서 보면 다음과 같은 결과가 나온다.

#### Kali에서 확인한 결과
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Meterpreter%20Extensions/Screenshot%20%26%20Keyscan/Source/%EC%8B%9C%EC%8A%A4%ED%85%9C%20%EC%82%AC%EC%A7%84%EC%B0%8D%EA%B8%B0(Kali%EC%97%90%EC%84%9C%20%ED%99%95%EC%9D%B8).png)  

## KeyScan 실습  
keyscan은 말 그대로 침투한 시스템의 사용자가 키보드를 통해 입력한 값들을 읽어 훔처오는 기능이다.  
따라서 공격대상의 시스템의 사용자가 작성한 텍스트들을 가져올 수 있다.  

**keyscan_start**  
keyscan을 시작한다.
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Meterpreter%20Extensions/Screenshot%20%26%20Keyscan/Source/%EC%8B%9C%EC%8A%A4%ED%85%9C%20keyscan(Kali).png)  
이렇게 명령어를 입력했다면 정상적으로 동작한다는 가정하에서는 현재 침투한 사용자가 키보드를 통해 입력하는 값들을 가져올 수 있을 것이다.

#### 현재 Window Xp의 상태
**cmd에서 notepad(메모장)을 실행**  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Meterpreter%20Extensions/Screenshot%20%26%20Keyscan/Source/%EC%8B%9C%EC%8A%A4%ED%85%9C%20keyscan(WindowXp).png)  
이렇게 메모장을 킨 상태에서 이제 사용자가 민감정보를 입력하고 있다는 가정하에 민감정보는 아니지만 민감정보라 가정하고 키보드를 통해 데이터를 입력.  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Meterpreter%20Extensions/Screenshot%20%26%20Keyscan/Source/%EC%8B%9C%EC%8A%A4%ED%85%9C%20keyscan(WindowXp%20%EB%AF%BC%EA%B0%90%EC%A0%95%EB%B3%B4%20%EC%9E%85%EB%A0%A5).png)  

침투한 system에서 keyscan을 시작하고 매우 긴 시간이 흘렀다고 가정하고 이제 dump를 통해 데이터를 전달받아보면 다음과 같은 결과를 받는다.  
**keyscan_dump**  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Meterpreter%20Extensions/Screenshot%20%26%20Keyscan/Source/%EC%8B%9C%EC%8A%A4%ED%85%9C%20keyscan%20dump(Kali).png)  
만약 정상적인 상황이라 가정했을 경우 dump를 입력했다면 현재 Window Xp의 notepad(메모장)에서 입력하며 키보드를 누른 모든 data들이 넘어와야하지만  
**현재 보는 사진과 같이 데이터가 하나도 넘어오지 않음을 알 수 있다.**  
그렇다면 이는 Meterpreter의 문제일까?  
대답은 -> No이다.  
일단 keyscan을 멈추고 난 후 다음의 명령어를 통해 보면 왜 입력이 들어오지 않는지 바로 알 수 있다.  
**keyscan_stop**  
**getuid**  
현재 침투한 시스템의 userid  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Meterpreter%20Extensions/Screenshot%20%26%20Keyscan/Source/%EC%8B%9C%EC%8A%A4%ED%85%9C%20keyscan%EC%8B%A4%ED%8C%A8(Kali).png)  
현재 Window Xp 시스템의 사용자는 SYStem이지만 notepad(메모장)를 작성한자는 누구일까 생각해보고 다음의 명령어를 통해 확인하면 무엇이 문제인지를 바로 알 수 있다.  
**ps**  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Meterpreter%20Extensions/Screenshot%20%26%20Keyscan/Source/%EC%8B%9C%EC%8A%A4%ED%85%9C%20keyscan%EC%8B%A4%ED%8C%A8%20%EC%9D%B4%EC%9C%A0(Kali).png)
다음의 사진에서 보다싶이 현재 notepad(메모장)의 사용자는 System이 아닌 ARAD4228 현재 Window Xp에 접근한 user이다.  
이는 매우 간단한 문제였다.  
그렇다면 이 사용자(ARAD4228)이 키보드를 통해 입력한 데이터를 전달받기 위해 어떠한 작업을 해야하는지 생각해본다면 매우 간단히 해결할 수 있을 것이다.  
그것은 바로 uid를 System에서 ARAD4228로 변경하여 데이터를 받아오면 된다.  
그러한 작업을 위해 아래의 명령어를 통해 변경을 하고 진행해 볼 것이다.  
**migrate (현재 notepad(메모장)의 PID)**  
**getuid**  
**keyscan_start**  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Meterpreter%20Extensions/Screenshot%20%26%20Keyscan/Source/%EC%8B%9C%EC%8A%A4%ED%85%9C%20keyscan%20%EC%88%98%EC%A0%95%ED%9B%84%20%EA%B3%B5%EA%B2%A9(Kali).png)  
이렇게 문제를 해결하고 다시 keyscan 다시 하고 결과를 보자.  

#### Window Xp의 현재 상태
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Meterpreter%20Extensions/Screenshot%20%26%20Keyscan/Source/%EC%8B%9C%EC%8A%A4%ED%85%9C%20keyscan(WindowXp%20%EB%AF%BC%EA%B0%90%EC%A0%95%EB%B3%B4%20%EC%9E%85%EB%A0%A52).png)  
현재 Window Xp의 사용자는 Kali에서 어떠한 작업을 진행하고 있는지 모른다는 가정하에  민감정보는 아니지만 민감정보를 입력하고 있다는 상황을 진행하고 있다.  

이후 오랜 시간이 지났다고 가정하고 이제 keyscan의 결과를 얻어오면 다음과 같은 결과를 얻을 수 있다.  
**keyscan_dump**  
![img](https://github.com/arad4228/2021_winter/blob/main/Kali_linux/Post%20Exploitation/Meterpreter%20Extensions/Screenshot%20%26%20Keyscan/Source/%EC%8B%9C%EC%8A%A4%ED%85%9C%20keyscan%20dump%20%EC%84%B1%EA%B3%B5(Kali).png)  
이로써 WindowXp에서 입력할 때 눌렀던 키보드의 입력값들이 모드 Kali의 meterpreter에 들어온것을 확인 할 수 있다.  

